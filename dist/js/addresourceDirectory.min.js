function dels(){ajaxRaw("POST","/cg/cgequipmenttestdevice/delete",JSON.stringify(delArr),function(e){initlist(1)})}function initlist(e){ajaxRaw("GET","/cg/cgequipmenttestdevice/deviceList",{page:e,limit:10},function(a){for(var t="",i=0;i<a.data.length;i++){t+="<tr>",t+="<td>",t+='<input type="checkbox" name="tablecheck" value="'+a.data[i].id+'">',t+=' <label for=""></label>',t+="   </td>",t+="  <td>"+(i+1)+"</td>",t+="  <td>"+a.data[i].deviceName+"</td>",t+='  <td><img src="'+imgUrl+"/"+a.data[i].mainPicture+'" width="53px" heihgt="30px" alt=""></td>',t+="  <td>"+a.data[i].majorField1+"</td>",t+=' <td class="tdAlert" id='+a.data[i].id+"><a>"+a.data[i].targetsCount+"</a></td>",t+=" <td>"+a.data[i].secretGrade+"</td>";var n="";2==a.data[i].keyEquipments?n="非重大":1==a.data[i].keyEquipments&&(n="重大"),t+=" <td>"+n+"</td>",t+="  <td>"+a.data[i].remark+"</td>",t+='  <td><span class="dels" ids="'+a.data[i].id+'" data-toggle="modal" data-target="#myModalDelete">删除</span></td>',t+="  </tr>"}$("#tbodys").html(t),page(e,10,parseInt(a.count),"pageBarCallBack","pageBar")})}function getPhoto(e,a,t){var i=new FormData;i.append("file",e.files[0]);var n=e.files[0].name;$("."+t).val(n),$("."+a).attr("keys",n),ajaxImg("/uploadLocal",i,function(e){0==e.code&&$("."+a).attr("src",imgUrl+"/"+e.file.url).attr("origin-url",e.file.url)})}function shengfen(e){ajax("get","/front/cgarea/findChilds/"+e,e,function(e){if(0==e.code){for(var a=e.areaList,t="",i=0;i<a.length;i++)t+="<option value='"+a[i].areaId+"' data-keys="+a[i].areaName+">"+a[i].areaName+"</option>";$("#province").html(t),$("#province").val(1),getcity($("#province").val(),1)}})}function getcity(e,a){ajax("get","/front/cgarea/findChilds/"+e,e,function(e){if(0==e.code){for(var t=e.areaList,i="",n=0;n<t.length;n++)i+="<option value='"+t[n].areaId+"' data-keys="+t[n].areaName+">"+t[n].areaName+"</option>";$("#city").html(i),a?($("#city").val(cgMember.city||1),getcounty($("#city").val(),a)):($("#city").val(t[0].areaId),getcounty(t[0].areaId,a))}})}function getcounty(e,a){ajax("get","/front/cgarea/findChilds/"+e,e,function(e){if(0==e.code){for(var t=e.areaList,i="",n=0;n<t.length;n++)i+="<option value='"+t[n].areaId+"' data-keys="+t[n].areaName+">"+t[n].areaName+"</option>";$("#county").html(i),a?$("#county").val(cgMember.county||1):$("#county").val(t[0].areaId||0)}})}$("header").load("../header.html"),$("footer").load("../footer.html");var pageBarCallBack=function(e){initlist(e)},pageBarCallBack2=function(e){initlist(e)};$("#datetimepicker-start").datetimepicker({format:"YYYY-MM-DD",locale:moment.locale("zh-cn")}),$("#datetimepicker-end").datetimepicker({format:"YYYY-MM-DD",locale:moment.locale("zh-cn")}),$("#approval_time").datetimepicker({format:"YYYY-MM-DD",locale:moment.locale("zh-cn")}),$("#datetimepicker_end").datetimepicker({format:"YYYY-MM-DD",locale:moment.locale("zh-cn")}),$("#datetimepicker_start").datetimepicker({format:"YYYY-MM-DD",locale:moment.locale("zh-cn")}),$("#mechanism_time").datetimepicker({format:"YYYY-MM-DD",locale:moment.locale("zh-cn")}),ajax("get","/unit/dicts/institutionalNatures","",function(e){if(0==e.code){for(var a=e.dicts,t="<option>请选择机构性质</option>",i=0;i<a.length;i++)t+="<option value='"+a[i].value+"'>"+a[i].value+"</option>";$("#state").html(t)}}),ajax("get","/unit/dicts/confidentialityQualificationLevel","",function(e){if(0==e.code){for(var a=e.dicts,t="",i=0;i<a.length;i++)t+="<option value='"+a[i].value+"'>"+a[i].value+"</option>";$("#confidentialityQualificationLevel").html(t)}}),ajax("get","/unit/dicts/legalPersonType","",function(e){if(0==e.code){for(var a=e.dicts,t="<option>请选择法人类别</option>",i=0;i<a.length;i++)t+="<option value='"+a[i].value+"'>"+a[i].value+"</option>";$("#legalPersonType").html(t)}}),ajax("get","/unit/dicts/unitCategorys","",function(e){if(0==e.code){for(var a=e.dicts,t="",i=0;i<a.length;i++)t+="<option value='"+a[i].value+"'>"+a[i].value+"</option>";$("#unitCategorys").html(t)}}),ajax("get","/unit/dicts/licensingUnit","",function(e){if(0==e.code){for(var a=e.dicts,t="<option>请选择发证单位</option>",i=0;i<a.length;i++)t+="<option value='"+a[i].value+"'>"+a[i].value+"</option>";$(".licensingUnit").html(t)}}),ajax("get","/cg/cgequipmentdict/getDictByType?type=1","",function(e){if(0==e.code){for(var a=e.data,t="<option>请选择发证单位</option>",i=0;i<a.length;i++)t+="<option value='"+a[i].value+"'>"+a[i].value+"</option>";$(".classifiy").html(t)}}),ajax("get","/cg/cgequipmentdict/getDictByType?type=3","",function(e){if(0==e.code)for(var a=e.data,t="<option>请选择发证单位</option>",i=0;i<a.length;i++)t+="<option value='"+a[i].value+"'>"+a[i].value+"</option>"}),ajax("get","/cg/cgequipmentdict/getDictByType?type=2","",function(e){if(0==e.code){for(var a=e.data,t="<option>请选择发证单位</option>",i=0;i<a.length;i++)t+="<option value='"+a[i].id+"'  data-keys="+a[i].value+" data-trem="+a[i].trem+">"+a[i].value+"</option>";$(".zhibiao").html(t)}}),ajax("get","/cg/cgequipmentdict/getDictByType?type=4","",function(e){if(0==e.code){for(var a=e.data,t="<option>请选择发证单位</option>",i=0;i<a.length;i++)t+="<option value='"+a[i].value+"'>"+a[i].value+"</option>";$("#sinstitutionalNature").append(t)}});var ids="",date=(new Date).getTime(),dateRandom=Math.floor(9999*Math.random(date)*date);ids=dateRandom,shengfen(0),""!=getQueryVariable("ids")&&setTimeout(function(){ajaxRaw("GET","/cg/cgequipmenttestresource/info/"+getQueryVariable("ids"),"",function(e){var a=e.cgEquipmentTestResource;if(ids=a.id,$(".sname").val(a.name),$(".salias").val(a.alias),$(".sfullName").val(a.fullName),$(".sauthState").val(a.authState),$(".briefIntro").val(a.briefIntro),$(".largeUnitName").val(a.largeUnitName),$(".srecommUnitName").val(a.recommUnitName),$(".suscc").val(a.uscc),$("#sinstitutionalNature").val(a.institutionalNature),$("#sestablish").val(a.establish),$(".secrecySeniorityLevel").val(a.secrecySeniorityLevel),$(".slegalName").val(a.legalName),$(".segalCategory").val(a.egalCategory),$(".sunitCategory").val(a.unitCategory),$(".sfax").val(a.fax),$(".stelphone").val(a.telphone),getcity(a.province),getcounty(a.city),$("#province").val(a.province),setTimeout(function(){$("#city").val(a.city),getcounty(a.city),setTimeout(function(){$("#county").val(a.county)},1e3)},3e3),$(".sdetailAddr").val(a.detailAddr),$(".smultipleAddr").val(a.multipleAddr),$(".sapprovalTime").val(a.approvalTime),0==a.abilityEntity.length)return!1;$(".contenPart_wraps").empty();for(var t=0;t<a.abilityEntity.length;t++){var i=a.abilityEntity[t],n=$(".tableList_two_clone").clone().show().addClass("ability_to");$(n).find(".briefDesc").val(i.briefDesc),$(n).find(".desc").val(i.describe),$(n).find(".classifiy").val(i.classifiy);var l=JSON.parse(i.acquiredQualifications);if(0!=l.length){$(n).find(".zili").empty();for(var o=0;o<l.length;o++){console.log(l[o]);var r=$(".test_sevenList_clone").clone().show();$(r).find(".sqdzz").val(l[o].sqdzz),$(r).find(".fzdw").val(l[o].fzdw),$(r).find(".zsbh").val(l[o].zsbh),$(r).find(".zsyxq_e").val(l[o].zsyxq_e),$(r).find(".zsyxq_s").val(l[o].zsyxq_s),$(n).find(".enclosureName").val(l[o].fileName),$(n).find(".enclosure").val(l[o].fileUrl),$(n).find(".fileName").text(l[o].fileName),$(n).find(".zili").append(r)}}$(".contenPart_wraps").append(n)}})},2e3),$(".save").on("click",function(){var e=[];if($(".ability_to").each(function(a,t){var i=[];e.push({acquiredQualifications:function(){for(var e=0;e<$(t).find(".zili_list").length;e++){var a=$(t).find(".zili_list")[e];i.push({fileUrl:$(".enclosure").val(),fileName:$(".enclosureName").val(),sqdzz:$(a).find(".sqdzz").val(),fzdw:$(a).find(".fzdw").val(),zsbh:$(a).find(".zsbh").val(),zsyxq_s:$(a).find(".zsyxq_s").val(),zsyxq_e:$(a).find(".zsyxq_e").val()})}return JSON.stringify(i)}(),briefDesc:$(t).find(".briefDesc").val(),classifiy:$(t).find(".classifiy").val(),describe:$(t).find(".desc").val(),resourceId:Math.floor(Math.random(ids)*ids)})}),""==$("input").val()||""==$("select").val())return!1;var a={id:Math.floor(ids),name:$(".sname").val(),alias:$(".salias").val(),fullName:$(".sfullName").val(),authState:parseInt($(".sauthState").val()),briefIntro:$(".briefIntro").val(),largeUnitName:$(".largeUnitName").val(),recommUnitName:$(".srecommUnitName").val(),uscc:$(".suscc").val(),institutionalNature:$("#sinstitutionalNature").val(),secrecySeniorityLevel:$(".secrecySeniorityLevel").val(),legalName:$(".slegalName").val(),egalCategory:$(".segalCategory").val(),establish:$("#sestablish").val(),unitCategory:$(".sunitCategory").val(),contacts:$(".scontacts").val(),telphone:$(".stelphone").val(),fax:$(".sfax").val(),province:parseInt($("#province").val()),city:parseInt($("#city").val()),county:parseInt($("#county").val()),detailAddr:$(".sdetailAddr").val(),multipleAddr:$(".smultipleAddr").val(),wholeAddr:$("#province option:selected").data("keys")+$("#city option:selected").data("keys")+$("#county option:selected").data("keys")+$(".sdetailAddr").val(),approvalTime:$(".sapprovalTime").val(),state:parseInt($(this).attr("status")),abilityEntity:e},t="save";""!=getQueryVariable("ids")&&(t="update"),ajaxRaw("POST","/cg/cgequipmenttestresource/"+t,JSON.stringify(a),function(e){0==e.code&&window.history.back()})}),$(document).on("change",".imgsfile",function(e){var a=new FormData,t={};a.append("file",e.currentTarget.files[0]);var i=$(this);ajaxImg("/uploadLocal",a,function(e){0==e.code&&(t=e,$(i).parent().siblings(".fileName").html(e.file.fileName),$(i).siblings(".enclosureName").val(e.file.fileName),$(i).siblings(".enclosure").val(e.file.url))})}),$(document).on("click",".addzi",function(){$(this).siblings(".zili").append($(".test_sevenList_clone").children().clone().show())}),$(".addAbility").on("click",function(){$(".contenPart_wraps").append($(".tableList_two_clone").clone().show().addClass("ability_to"))}),$(".addTarget").on("click",function(){$(".form-group_wraps").append($(".form-group_clone").clone().show().addClass("form-group_list").removeClass("form-group_clone"))});var delArr=[];$(document).on("click",".dels",function(){delArr=[],delArr=[$(this).attr("ids")],dels()}),$(".alldel").on("click",function(){delArr=[],$("input[name=tablecheck]:checked").each(function(){delArr.push($(this).val())}),dels()}),initlist(1),$(document).on("click",".tdAlert",function(){ajaxRaw("GET","/cg/cgequipmenttestdevice/target?page=1&limit=10&id="+$(this).attr("id"),"",function(e){page(pages,10,parseInt(e.count),"pageBarCallBack2","pageBar2"),console.log(e)})}),$(document).on("change",".zhibiao",function(){$(this).find("option:selected").data("trem"),"约束"==$(this).find("option:selected").data("trem")?$(this).parent().parent().parent().siblings(".conect_one").find(".zhibiaozhi2").show():$(this).parent().parent().parent().siblings(".conect_one").find(".zhibiaozhi2").hide()}),$(".listSaveAdd").on("click",function(){if(""==$(".deviceName").val())return $(".deviceName").siblings(".erros").show(),!1;if(""==$(".keyEquipments").val())return $(".keyEquipments").siblings(".erros").show(),!1;if(""==$(".remark").val())return $(".remark").siblings(".erros").show(),!1;if(""==$(".majorField1").val())return $(".majorField1").siblings(".erros").show(),!1;if(""==$(".secretGrade").val())return $(".secretGrade").siblings(".erros").show(),!1;var e={};$(".relative-img").each(function(){if(""==$(this).attr("src"))return!1;var a=$(this).attr("keys"),t=$(this).attr("origin-url");e[a]=t});var a=(new Date).getTime(),t=Math.floor(99999*Math.random(a)),i={resourceId:JSON.stringify(t),deviceName:$(".deviceName").val(),keyEquipments:$(".keyEquipments").val(),mainPicture:$(".mainPicture").attr("origin-url"),pictures:JSON.stringify(e),remark:$(".remark").val(),majorField1:$(".majorField1").val(),secretGrade:$(".secretGrade").val(),targetResource:function(){var e=[],a=$(".form-group_wraps").find(".form-group_list");return $(a).each(function(a,t){e.push({targetValue:$(t).find(".zhibiaozhi").val()+"-"+$(t).find(".zhibiaozhi2").val(),targetId:$(t).find(".zhibiao").val(),targetName:$(t).find(".zhibiao option:selected").data("keys")})}),e}()};$(this).attr("data-dismiss","modal"),ajaxRaw("POST","/cg/cgequipmenttestdevice/save",JSON.stringify(i),function(e){initlist(1)})});var cgMember={};